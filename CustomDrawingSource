local CustomDrawing = {}
CustomDrawing.__index = CustomDrawing

-- Helper function to find or create the ScreenGui in CoreGui
local function getOrCreateScreenGui()
    local CoreGui = game:GetService("CoreGui")
    local existingGui = CoreGui:FindFirstChild("CustomDrawingGui")
    
    if existingGui then
        return existingGui  -- Reuse the existing ScreenGui
    else
        -- Create the ScreenGui
        local screenGui = Instance.new("ScreenGui")
        screenGui.Name = "CustomDrawingGui"
        screenGui.Parent = CoreGui
        return screenGui
    end
end

-- CustomDrawing.new("Line", {Transparency = 0.5, Thickness = 3, From = Vector2.new(100, 100), To = Vector2.new(400, 300)})
function CustomDrawing.new(type, options)
    if type == "Line" then
        local self = setmetatable({}, CustomDrawing)

        -- Get or create the ScreenGui in CoreGui
        self.screenGui = getOrCreateScreenGui()

        -- Create the Frame to represent the line
        self.lineFrame = Instance.new("Frame")
        self.lineFrame.AnchorPoint = Vector2.new(0.5, 0.5)
        self.lineFrame.BorderSizePixel = 0
        self.lineFrame.BackgroundColor3 = Color3.fromRGB(255, 0, 0)  -- Red color for visibility (can be changed)
        self.lineFrame.Parent = self.screenGui

        -- Set default or initial properties
        self._transparency = options.Transparency or 0  -- Default 0 (fully opaque)
        self._thickness = options.Thickness or 1        -- Default 1 (smallest thickness)
        self._from = options.From or Vector2.new(0, 0) -- Default starting point (top-left)
        self._to = options.To or Vector2.new(100, 100) -- Default ending point

        -- Draw the line based on the initial properties
        self:updateLine()

        return setmetatable(self, {
            __index = self,
            __newindex = function(t, key, value)
                if key == "Transparency" then
                    rawset(t, "_transparency", value)
                    t:updateLine()
                elseif key == "Thickness" then
                    rawset(t, "_thickness", value)
                    t:updateLine()
                elseif key == "From" then
                    rawset(t, "_from", value)
                    t:updateLine()
                elseif key == "To" then
                    rawset(t, "_to", value)
                    t:updateLine()
                else
                    rawset(t, key, value)
                end
            end
        })
    else
        error("Unsupported drawing type: " .. tostring(type))
    end
end

-- Update the line based on its properties
function CustomDrawing:updateLine()
    local deltaX = self._to.X - self._from.X
    local deltaY = self._to.Y - self._from.Y
    local distance = math.sqrt(deltaX * deltaX + deltaY * deltaY)

    -- Update size, position, transparency, and rotation
    self.lineFrame.Size = UDim2.new(0, distance, 0, self._thickness)
    self.lineFrame.Position = UDim2.new(0, (self._from.X + self._to.X) / 2, 0, (self._from.Y + self._to.Y) / 2)
    self.lineFrame.Rotation = math.deg(math.atan2(deltaY, deltaX))
    self.lineFrame.BackgroundTransparency = self._transparency
end

return CustomDrawing
